<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestion de chantier — Démo Artisan</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-gray-800">

<div id="app">
  <!-- Header -->
  <header class="bg-blue-600 text-white p-4">
    <h1 class="text-xl font-bold">Gestion de chantier — Démo Artisan</h1>
  </header>

  <div class="flex">
    <!-- Sidebar -->
    <nav id="sidebar" class="w-64 p-4 bg-gray-100">
      <ul class="space-y-2">
        <li><button class="w-full text-left" onclick="setActiveView('dashboard')">Tableau de bord</button></li>
        <li><button class="w-full text-left" onclick="setActiveView('projects')">Chantiers</button></li>
        <li><button class="w-full text-left" onclick="setActiveView('quotes')">Devis & Factures</button></li>
        <li><button class="w-full text-left" onclick="setActiveView('planning')">Planning</button></li>
        <li><button class="w-full text-left" onclick="setActiveView('employees')">Salariés</button></li>
        <li><button class="w-full text-left" onclick="setActiveView('materials')">Matériaux</button></li>
        <li><button class="w-full text-left" onclick="setActiveView('ae')">Auto-entrepreneur</button></li>
        <li><button class="w-full text-left" onclick="setActiveView('settings')">Paramètres</button></li>
      </ul>
    </nav>

    <!-- Main content -->
    <main id="main-content" class="flex-1 p-4"></main>
  </div>
</div>

<script type="module">
// ==========================
// 1️⃣ CLÉ API GEMINI
// ==========================
const GEMINI_API_KEY = AIzaSyAV-oQQ9hnAywalaWPznyBpiOKUVprn9tA; // <-- mets ta clé Gemini ici

async function callGemini(prompt) {
    const response = await fetch("https://api.gemini.com/v1/responses", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${GEMINI_API_KEY}`
        },
        body: JSON.stringify({ prompt })
    });
    const data = await response.json();
    return data;
}

// ==========================
// 2️⃣ Initialisation des données
// ==========================
let state = JSON.parse(localStorage.getItem('appState')) || initState();

function initState() {
    const year = new Date().getFullYear();
    const demoState = {
        projects: [
            { id: 1, name: "Maison Dupont", client: "Dupont", start: `${year}-06-01`, end: `${year}-08-01`, status: "En cours", tasks: [], materials: [], employees: [1], quotes: [1], invoices: [1] },
            { id: 2, name: "Appartement Martin", client: "Martin", start: `${year}-05-01`, end: `${year}-06-15`, status: "Terminé", tasks: [], materials: [], employees: [2], quotes: [2], invoices: [2] }
        ],
        clients: ["Dupont", "Martin"],
        employees: [
            {id:1,name:"Jean",role:"Chef de chantier"},
            {id:2,name:"Lucie",role:"Ouvrier"}
        ],
        quotes: [],
        invoices: [],
        materials: [],
        settings: { status: "Auto-entrepreneur", plafond: 77700 }
    };
    localStorage.setItem('appState', JSON.stringify(demoState));
    return demoState;
}

// ==========================
// 3️⃣ Navigation
// ==========================
function setActiveView(view) {
    const main = document.getElementById('main-content');
    main.innerHTML = "";
    if(view === 'dashboard') renderDashboard();
    if(view === 'projects') renderProjectsView();
}

// ==========================
// 4️⃣ Vues simples pour commencer
// ==========================
function renderDashboard() {
    const main = document.getElementById('main-content');
    main.innerHTML = `<h2 class="text-lg font-bold mb-4">Tableau de bord</h2>
        <p>Nombre de chantiers : ${state.projects.length}</p>
    `;
}

function renderProjectsView() {
    const main = document.getElementById('main-content');
    state.projects.forEach(p => {
        const div = document.createElement('div');
        div.className = "border p-2 mb-2";
        div.innerHTML = `<strong>${p.name}</strong> — ${p.status}`;
        main.appendChild(div);
    });
}

// ==========================
// 5️⃣ Vue par défaut
// ==========================
setActiveView('dashboard');

</script>
</body>
</html>
