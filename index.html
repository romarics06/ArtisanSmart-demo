<script>
  // ==========================
  // GEMINI API – Version 100 % fonctionnelle novembre 2025
  // ==========================
  window.GEMINI_API_KEY = "AIzaSyAV-oQQ9hnAywalaWPznyBpiOKUVprn9tA"; // Ta clé (elle est bonne, on la garde)

  window.callGemini = async function(prompt, isTest = false) {
    if (!window.GEMINI_API_KEY || window.GEMINI_API_KEY.includes("remplace")) {
      alert("Clé API manquante ou invalide !");
      return null;
    }

    const url = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${window.GEMINI_API_KEY}`;

    try {
      const response = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          contents: [{ role: "user", parts: [{ text: prompt }] }],
          generationConfig: { temperature: 0.7, maxOutputTokens: 1024 }
        })
      });

      if (!response.ok) {
        const err = await response.text();
        throw new Error(`Erreur ${response.status} : ${err}`);
      }

      const data = await response.json();
      const text = data.candidates[0].content.parts[0].text;
      return isTest ? "API Gemini 1.5 Flash OK – tout fonctionne !" : text;

    } catch (error) {
      console.error("Erreur Gemini :", error);
      alert(`Erreur API : ${error.message}\n\nVérifie que ta clé est activée sur https://aistudio.google.com/app/apikey`);
      return null;
    }
  };

  // Bouton test
  document.getElementById("test-api").addEventListener("click", async () => {
    const result = await window.callGemini("Dis-moi bonjour en français.", true);
    document.getElementById("gemini-output").classList.remove("hidden");
    document.getElementById("output-content").innerHTML = `<p class="text-green-600 font-bold">${result}</p>`;
  });

  // Générer texte Landing Page (prompt enrichi avec tout ce qu’on a vu)
  document.getElementById("generate-text").addEventListener("click", async () => {
    const prompt = `Tu es un copywriter expert SaaS B2B pour artisans du bâtiment.

Écris un texte complet et ultra-converti pour la landing page d’ArtisanSmart (nouveau SaaS français).

Inclus :
- Hero avec slogan fort + sous-titre
- 3 blocs features avec KPI concrets (ex : "1 devis IA = 5h gagnées")
- Bloc pricing clair (29€ / 59€ / 99€)
- Bloc témoignages (2 faux réalistes)
- CTA fort "50 places early – essai gratuit 14 jours"

Ton : simple, direct, proche de l’artisan, français courant, zéro bullshit.

Utilise les features suivantes :
- Devis IA en 20s
- Factur-X & Chorus Pro intégrés
- Planning intelligent offline
- Photos chantier → analyse IA avancement
- Relances cashflow auto
- Module Auto-entrepreneur (alertes URSSAF, plafond)
- Dashboard KPI valeur (temps gagné, CA attente, impayés évités)

Finis par un CTA urgent : "50 places early à 29,90€/mois – disparues en 48h".`;

    const output = await window.callGemini(prompt);
    if (output) {
      document.getElementById("gemini-output").classList.remove("hidden");
      document.getElementById("output-content").innerHTML = `<pre class="bg-white p-6 rounded-lg shadow overflow-auto text-sm whitespace-pre-wrap">${output}</pre>`;
    }
  });
</script>
